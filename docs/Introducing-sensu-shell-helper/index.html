<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Introducing sensu-shell-helper!" />
<meta property="og:description" content="The Problem The barrier to writing Nagios checks is high. I dare say very high. You have to think about check intervals, host groups, service groups, config files, etc.
But, I know my servers are not behaving, if only there was a way to check them! They run commands for me all the time. In the worst case they fail and no one knows. The best case is that they end up in my cron spam folder&hellip;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/Introducing-sensu-shell-helper/" />
<meta property="article:published_time" content="2013-12-15T09:12:26+00:00" />
<meta property="article:modified_time" content="2013-12-15T09:12:26+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Introducing sensu-shell-helper!"/>
<meta name="twitter:description" content="The Problem The barrier to writing Nagios checks is high. I dare say very high. You have to think about check intervals, host groups, service groups, config files, etc.
But, I know my servers are not behaving, if only there was a way to check them! They run commands for me all the time. In the worst case they fail and no one knows. The best case is that they end up in my cron spam folder&hellip;."/>


    <meta name="description" content="">
    <link rel="canonical" href="../Introducing-sensu-shell-helper/">

    
    <title>Introducing sensu-shell-helper! &middot; xkyle.com</title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="css/style.css" rel="stylesheet">

    

    

    
  </head>
  <body>
    
      



<nav class="white" role="navigation">
    <div class="row max-width">
        <div class="col s12 l10 offset-l1">
            
            <a href="#" data-target="nav-mobile" class="sidenav-trigger black-text">
                <i class="material-icons">menu</i>
            </a>

            
            <ul id="nav-mobile" class="sidenav">
                
                
    
    

            </ul>

            
            <a href="../" class="brand-logo grey-text text-darken-3">xkyle.com</a>

            
            <div class="nav-wrapper">

                
                <ul class="right hide-on-med-and-down">
                    
                    
    
    

                </ul>

            </div>
        </div>
    </div>
</nav>
    

    

<article class="max-width">
    
    <section class="row">
        <div class="col s12 m10 offset-m1 l10 offset-l1">
            <h1>Introducing sensu-shell-helper!</h1>
        </div>
    </section>

    
    

    
    <section class="row">
        <div class="col s12 m8 offset-m2 l2 offset-l1">
            

<p class="article-meta">
    <div class="article-meta-container">
        <div class="article-meta-author-name"></div>
        <div class="article-meta-description"></div>
    </div>
    <span class="article-meta-published-at grey-text text-darken-1">Dec 15, 2013</span>
</p>
        </div>
        <div class="col s12 m8 offset-m2 l6">
            

<h2 id="the-problem">The Problem</h2>

<p>The barrier to writing Nagios checks is high. I dare say <em>very</em> high. You have
to think about check intervals, host groups, service groups, config files, etc.</p>

<p>But, I know my servers are not behaving, if only there was a way to check them!
They run commands for me all the time. In the worst case they fail and no one
knows. The best case is that they end up in my cron spam folder&hellip;.</p>

<h2 id="a-solution">A Solution!</h2>

<p><a href="https://github.com/solarkennedy/sensu-shell-helper">Sensu-shell-helper</a>. It is
a small script I wrote to make it easier to monitor arbitrary commands with
Sensu. Here is how you use it</p>

<pre><code>sensu-shell-helper apt-get update
</code></pre>

<p>Yes. That is it. No mandatory config options. Good defaults. Minimal overhead.
What does this check look like in the dashboard when it fails?</p>

<p><img src="../uploads/sensu-helper-screenshot.png" alt="" /></p>

<p>Exactly what I wanted. And of course, when apt-get update begins to work again,
the check will resolve itself.</p>

<h2 id="under-the-hood">Under The Hood</h2>

<p>sensu-shell-helper reall just takes in the output of the command you ask for,
tail&rsquo;s it, then sends the result to localhost:3030, which the sensu-client
listens on.</p>

<p>By default it does not specify any handlers. (But they can be specified on the
command line with -H) For the check-name it takes the full command and munges
it to pass the sensu validator. Duplicate instances of the exact same command
on a particular host will be seen as a single &ldquo;check&rdquo;.</p>

<p>Most commands do not return 0,1,2,3 according to the
<a href="http://sensuapp.org/docs/0.12/checks">Sensu</a> /
<a href="https://www.nagios-plugins.org/doc/guidelines.html#AEN78">Nagios plugin API</a>,
so the sensu-shell-helper will emit 2 (critical) in the event that the
shell command returns anything non-zero. This behavior can be overridden
with -N in the case that your command does conform to the 0,1,2,3 spec.</p>

        </div>
    </section>
</article>



    
      <footer class="page-footer grey lighten-5">
    <div class="row max-width">
        <div class="col s12 l10 offset-l1 clear-padding">
            <div class="row">
    
        
    

    
    
    <div class="col s12 l12">
        <h5 class="black-text"></h5>
<p class="grey-text text-darken-4"></p>

    </div>

    
</div>


        </div>
    </div>
    <div class="footer-copyright">
        <div class="row max-width" style="width: 100%;">
            <div class="col s12 l10 offset-l1">
                <span class="grey-text text-darken-4"></span>
<div class="right">
    
</div>
            </div>
        </div>
    </div>
</footer>
    

    
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="js/script.js"></script>
  </body>
</html>
